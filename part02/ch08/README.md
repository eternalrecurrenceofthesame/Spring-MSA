# 스프링 클라우드 소개

스프링 클라우드를 사용해서 확장성, 견고성, 보안성, 탄력성과 구성 가능성이 있고 상용화 준비가 완료된

서비스 만들어보기 

## 넷플릭스 유레카를 검색 서비스로 사용하기
```
기존 마이크로서비스와 해당 인스턴스를 찾고자 검색 서비스를 사용한다. 
```
## 스프링 클라우드 게이트웨이를 에지 서버로 사용
```
마이크로서비스 환경을 보호하기 위해 에지 서버를 사용한다. 사설 서비스를 외부에서 접근하지 못하게 숨기고
외부 클라이언트가 공개 서비스를 사용할 때 보호한다.

스프링 클라우드 게이트웨이는 리액터 기반의 논블로킹 API 를 사용한다. 넷플릭스 주울(블로킹 API) 에 비해 
더 많은 양의 동시 요청을 처리할 수 있다. 이는 모든 외부 트래픽을 처리하는 에지 서버에 중요한 특성이다. 
```
## 구성 중앙화를 위해 스프링 클라우드 컨피그 사용
```
공통 정보는 공통 파일에 배치하고 특정 마이크로서비스를 위한 설정은 별도의 구성 파일에 배치할 수 있다.

또한 구성 변경을 감지하여 스프링 클라우드 버스를 사용해서 영향받는 마이크로서비스로 알림을 보내는 기능도
지원한다.(래빗 및 카프카를 사용함)

1. 마이크로서비스는 컨피그 서버에 구성을 요청하면서 시작한다.
2. 컨피그 서버는 깃 저장소에서 구성을 가져온다.
3. 깃 저장소에 깃 커밋이 푸시되면 컨피그 서버에 알림을 보내도록 깃 저장소를 구성한다(선택)
4. 컨피그 서버는 클라우드 버스를 사용해 변경 이벤트를 게시하고 변경에 영향을 받는 마이크로서비스는
이에 반응해 컨피그 서버에 업데이트된 구성을 가져온다. 
```
## 탄력성 향상을 위해 Resilience4j 사용하기
```
ch01 서킷 브레이커 부분 참고
 
1. 서킷 브레이커가 닫힘 상태에서 시작해 요청을 처리한다. 
2. 요청이 성공적으로 처리되는 한 닫힘 상태를 유지한다.
3. 요청에 실패하면 카운터 값이 증가하기 시작한다.
4. 설정한 실패 임계값에 도달하면 서킷 브레이커가 트립한다. 추가 요청을 처리할 수 없는
열림 상태가 된다.

5. 요청은 빠르게 실패하고 곧바로 예외를 반환한다.
6. 설정한 시간이 지나면 서킷 브레이커가 반열림 상태로 전환되고 프로브 요청을 하나
보내서 문제가 해결됐는지 확인한다.

7. 프로브 요청이 실패하면 서킷 브레이커는 다시 열림 상태로 돌아간다.
8. 프로브 요청이 성공하면 서킷 브레이커는 닫힘 상태로 초기화 되고 새 요청을 처리할 수 있다.
```
## 스프링 클라우드 슬루스와 집킨을 사용한 분산 추적
```
스프링 클라우드 슬루스는 상관 ID 를 사용해서 하나의 처리 흐름에 포함된 요청과 메시지/이벤트에
표시를 남긴다.

처리 흐름에서 나오는 여러 마이크로서비스의 로그 메시지를 쉽게 추적할 수 있도록 로그 메시지에 
상관 ID 를 덧붙인다. 슬루스는 추적 데이터를 저장 및 시각화하고자 분산 추적 시스템인 집킨으로 보낸다. 
```

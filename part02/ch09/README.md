# 넷플릭스 유레카와 리본을 사용한 서비스 검색

마이크로서비스는 넷플릭스 유레카 클라이언트 모듈을 사용해서 넷플릭스 유레카와 통신한다. 

## 서비스 검색 소개 

### DNS 기반 서비스 검색의 문제점
```
DNS 란? 도메인 이름을 사용했을 때 도메인을 실제 네트워크상의 IP 로 바꾸는 과정을 의미한다. 
```
```
DNS 클라이언트는 보통 리졸브된 IP 주소를 캐시하고 DNS 이름에 대응되는 IP 주소가 여러 개인 경우 동작하는 첫 번째 IP 주소를 계속
사용한다.

즉 컨테이너에 올라간 마이크로서비스의 인스턴스를 두 개로 확장해도 두 개의 인스턴스가 같은 주소값을 가지게 되고 하나의 인스턴스만
사용하게 된다. 동적으로 변하는 마이크로서비스 인스턴스를 처리한는 데 적합하지 않다! 333 p 참고 
```
### 넷플릭스 유레카를 사용한 서비스 검색
```
클라이언트는 사용 가능한 마이크로서비스 인스턴스의 정보를얻고자 검색 서비스 넷플릭스 유레카와 통신한다.

1. review 서비스 등의 마이크로서비스 인스턴스는 시작할 때마다 자신을 유레카 서버에 등록한다.

2. 각 마이크로서비스 인스턴스는 자신이 정상이며 요청을 받을 준비가 됐음을 알리고자 정기적으로 유레카 서버에
하트비트 메시지를 보낸다.

3. 복합 마이크로서비스 같은 클라이언트는 클라이언트 라이브러리를 사용해, 사용 가능한 서비스의 정보를 정기적으로
유레카 서비스에 요청한다.

4. 클라이언트에서 다른 마이크로서비스로 요청을 보내야 하는 경우에는 검색 서버에 요청하지 않고도 클라이언트 라이브러리에
보존된 사용 가능한 인스턴스 목록에서 대상을 선택할 수 있으며 보통 라운드 로빈 방식으로 인스턴스를 선택한다 ??
```
## 넷플릭스 유레카 서버 설정하기
```
* docker-compose

eureka:
  build: spring-cloud/eureka-server
  mem_limit: 512m
  ports:
    - "8761:8761"  # 마이크로서비스에서 사용하는 8080 기본 포트를 변경한다. 
```
## 넷플릭스 유레카 서버에 마이크로서비스 연결하기
```
* 테스트 수정하기

단일 마이크로서비스 테스트시에는 유레카 서버를 실행할 필요가 없기 때문에 @SpringBootTest 애노테이션에 유레카 false 를 추가한다.
@SpringBootTest(webEnviornment=RANDOM_PORT, properties = {"eureka.client.enabled=false"})
```
